apiVersion: networking.matrixinfer.ai/v1alpha1
kind: ModelRoute
metadata:
  name: multi-backend-model
  namespace: dev
  labels:
    registry.matrixinfer.ai/backend-name: ""
    registry.matrixinfer.ai/managed-by: registry.matrixinfer.ai
    registry.matrixinfer.ai/model-name: multi-backend-model
    registry.matrixinfer.ai/model-uid: randomUID
    registry.matrixinfer.ai/revision: 7b67c97bcb
  ownerReferences:
    - apiVersion: registry.matrixinfer.ai/v1alpha1
      kind: Model
      name: multi-backend-model
      uid: randomUID
spec:
  modelName: "multi-backend-model"
  loraAdapters:
    - "lora-sql-1"
    - "lora-sql-2"
  rules:
    - name: "default"
      modelMatch:
        headers:
          users:
            exact: "john"
        body:
          model: "multi-backend-model"
      targetModels:
        - modelServerName: "multi-backend-model-backend1"
          weight: 40
        - modelServerName: "multi-backend-model-backend2"
          weight: 60
    - name: "lora-sql-1"
      modelMatch:
        headers:
          users:
            exact: "john"
        body:
          model: "lora-sql-1"
      targetModels:
        - modelServerName: "multi-backend-model-backend1"
          weight: 40
    - name: "lora-sql-2"
      modelMatch:
        headers:
          users:
            exact: "john"
        body:
          model: "lora-sql-2"
      targetModels:
        - modelServerName: "multi-backend-model-backend1"
          weight: 40
        - modelServerName: "multi-backend-model-backend2"
          weight: 60
