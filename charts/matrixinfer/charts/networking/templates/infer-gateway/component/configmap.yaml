apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "matrixinfer.name" . }}-infer-gateway-config
  namespace: {{ .Release.Namespace }}
data:
  gatewayConfiguration: |-
    scheduler:
      pluginConfig:
      - name: least-request
        args:
          maxWaitingRequests: 10
      - name: least-latency
        args:
          TTFTTPOTWeightFactor: 0.5
      - name: prefix-cache
        args:
          blockSizeToHash: 64
          maxBlocksToMatch: 128
          maxHashCacheSize: 50000
      - name: kvcache-aware
        args:
          blockSizeToHash: 128
          maxBlocksToMatch: 128
          redis: {{.Values.redis.enabled}}
      plugins:
        Filter:
          enabled:
            - least-request
          disabled:
            - lora-affinity
        Score:
          enabled:
            - name: least-request
              weight: 1
            - name: gpu-usage
              weight: 1
            - name: least-latency
              weight: 1
            - name: prefix-cache
              weight: 1
            - name: kvcache-aware
              weight: 1
